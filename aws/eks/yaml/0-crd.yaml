---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: friendliconfigs.friendli.ai
spec:
  group: friendli.ai
  names:
    kind: FriendliConfig
    listKind: FriendliConfigList
    plural: friendliconfigs
    singular: friendliconfig
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: FriendliConfig is the Schema for the friendliconfigs API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: FriendliConfigSpec defines the desired state of FriendliConfig
            properties:
              containerSecret:
                description: Friendli Container activation code.
                properties:
                  key:
                    description: The key of the secret to select from.
                    type: string
                  name:
                    description: Name of the referent secret.
                    type: string
                type: object
              engine:
                description: Friendli Engine configuration.
                properties:
                  image:
                    description: The engine image
                    type: string
                  inferencePort:
                    description: The TCP port that inference API server binds to.
                    format: int32
                    type: integer
                  logLevel:
                    description: The log level. If omitted, the default level is INFO.
                    type: string
                  metricPort:
                    description: The TCP port for exposing Prometheus-compatible metrics.
                    format: int32
                    type: integer
                type: object
              modelRepositorySecrets:
                description: Model repository secrets.
                properties:
                  huggingFaceToken:
                    description: HuggingFace token.
                    properties:
                      key:
                        description: The key of the secret to select from.
                        type: string
                      name:
                        description: Name of the referent secret.
                        type: string
                    type: object
                type: object
              personalAccessToken:
                description: Personal access token to access the container image registry
                  (Friendli Token).
                properties:
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                      TODO: Add other useful fields. apiVersion, kind, uid?
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              serviceAccountName:
                description: Service account which will be used for inference pods
                  to communicate with AWS license manager.
                type: string
            type: object
          status:
            description: FriendliConfigStatus defines the observed state of FriendliConfig
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: friendlideployments.friendli.ai
spec:
  group: friendli.ai
  names:
    kind: FriendliDeployment
    listKind: FriendliDeploymentList
    plural: friendlideployments
    shortNames:
    - fd
    singular: friendlideployment
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: FriendliDeployment is the Schema for the friendlideployments
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: FriendliDeploymentSpec defines the desired state of FriendliDeployment
            properties:
              arguments:
                additionalProperties:
                  type: string
                description: Additional Engine Arguments
                type: object
              engine:
                description: Friendli Engine configuration.
                properties:
                  image:
                    description: The engine image
                    type: string
                  inferencePort:
                    description: The TCP port that inference API server binds to.
                    format: int32
                    type: integer
                  logLevel:
                    description: The log level. If omitted, the default level is INFO.
                    type: string
                  metricPort:
                    description: The TCP port for exposing Prometheus-compatible metrics.
                    format: int32
                    type: integer
                type: object
              model:
                description: The LLM Model to deploy.
                properties:
                  huggingFace:
                    description: HuggingFace model.
                    properties:
                      repository:
                        description: HuggingFace repository name.
                        type: string
                      token:
                        description: Optional HuggingFace token.
                        properties:
                          key:
                            description: The key of the secret to select from.
                            type: string
                          name:
                            description: Name of the referent secret.
                            type: string
                        type: object
                    type: object
                type: object
              resources:
                description: The resource to be used.
                properties:
                  limits:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: Kubernetes resource limits for the engine container.
                    type: object
                  nodeSelector:
                    additionalProperties:
                      type: string
                    description: Node selector.
                    type: object
                  numGPUs:
                    description: Number of GPUs to use. If omitted, operator will
                      automatically infer the number of GPUs from the "requests" and
                      "limits" field.
                    format: int32
                    type: integer
                  requests:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: Kubernetes resource requests for the engine container.
                    type: object
                  tolerations:
                    description: |-
                      Additional tolerations for the deployment.
                      By default, nvidia.com/gpu (Exists) taint is tolerated.
                    items:
                      description: |-
                        The pod this Toleration is attached to tolerates any taint that matches
                        the triple <key,value,effect> using the matching operator <operator>.
                      properties:
                        effect:
                          description: |-
                            Effect indicates the taint effect to match. Empty means match all taint effects.
                            When specified, allowed values are NoSchedule, PreferNoSchedule and NoExecute.
                          type: string
                        key:
                          description: |-
                            Key is the taint key that the toleration applies to. Empty means match all taint keys.
                            If the key is empty, operator must be Exists; this combination means to match all values and all keys.
                          type: string
                        operator:
                          description: |-
                            Operator represents a key's relationship to the value.
                            Valid operators are Exists and Equal. Defaults to Equal.
                            Exists is equivalent to wildcard for value, so that a pod can
                            tolerate all taints of a particular category.
                          type: string
                        tolerationSeconds:
                          description: |-
                            TolerationSeconds represents the period of time the toleration (which must be
                            of effect NoExecute, otherwise this field is ignored) tolerates the taint. By default,
                            it is not set, which means tolerate the taint forever (do not evict). Zero and
                            negative values will be treated as 0 (evict immediately) by the system.
                          format: int64
                          type: integer
                        value:
                          description: |-
                            Value is the taint value the toleration matches to.
                            If the operator is Exists, the value should be empty, otherwise just a regular string.
                          type: string
                      type: object
                    type: array
                required:
                - limits
                - requests
                type: object
              scaling:
                description: The deployment scaling config.
                properties:
                  replicas:
                    description: Number of replicas.
                    format: int32
                    type: integer
                type: object
              service:
                description: Service config.
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: Annotations
                    type: object
                  clusterIP:
                    description: |-
                      clusterIP is the IP address of the service.
                      Assigning "None" will make this service headless.
                    type: string
                  externalTrafficPolicy:
                    description: Service external traffic policy.
                    type: string
                  inferencePort:
                    description: The TCP port that inference API binds to.
                    format: int32
                    type: integer
                  internalTrafficPolicy:
                    description: Service internal traffic policy.
                    type: string
                  type:
                    description: Type of the service.
                    type: string
                type: object
              useConfig:
                description: FriendliConfig to be used. If omitted, the operator will
                  automatically select one if there is only one FriendliConfig in
                  the namespace.
                properties:
                  name:
                    type: string
                type: object
            type: object
          status:
            description: FriendliDeploymentStatus defines the observed state of FriendliDeployment
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
